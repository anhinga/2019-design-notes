# Architecture notes (in progress)

I don't have a ready final architecture in my mind, which just needs to be written. The [History.md](History.md) gives me some ideas and some warnings about potential problems.

So I'll start just with putting notes about those ideas and those problems here.

## Preliminary snippets

### Graph editor controller for a changing graph

This is an interesting problem. If one edits on the level of network matrix, one can trigger a change without knowing the exact state of the matrix. Even if the change algebraically depends on the moving target, still one can use the current snapshot of that target to get the needed values.

But with explicit graph editing one cannot play it this way: if a graph is changing in front of you, it would not be possible to reasonably manipulate it with a mouse.

So a tentative solution is as follows: if one is dealing with a morphing graph, one makes a copy (which is a frozen in time snapshot of the graph in question), edits it, and sends forward a delta generated by this edit. We expect that any given delta can always be applied to any graph whatsoever (this is certainly true, if one does it on the level of weight-connectivity matrices corresponding to the graphs, one can always add two matrices, and any matrix over reasonable signature of indices has an interpretation as a network graph).

It's all good for small graphs. Navigating and editing large graphs is a separate non-trivial problem (but it should at least be considered for Stage 1).

The exact interplay of graph and matrix representations also requires further thoughts. Do we store both and make sure that they are always in sync? So we have further topic for meditation on graph controllers.

### Various kinds of streamed objects

We were always able to stick to one kind of streamed objects in our experiments. First, these were images (in the pre-DMM experiments), then numbers (in early DMMs), then network-sized matrices (in Lightweight pure DMMs), then finally V-values (and V-values are universal enough to allow to embed any reasonable streams of objects into streams of appropriately crafted V-values (Section 5.3 of https://arxiv.org/abs/1712.07447 ).

However, in principle, nothing precludes having different kinds of streams in a DMM (Section 3 of https://arxiv.org/abs/1605.05296 ). And I really want to avoid making a decision to stick to a particular kind of streams at this point, even if that kind is sufficiently universal.

So, if we are just talking about stream-based programming (forgetting about the requirement of being able to take linear combinations for a bit), we might want to say that an element of the stream is to belong to a specific Class. We might also say that there is an Empty element (belonging to a specific subclass of that Class), that a receiver which does not know what to do with an element of a particular kind always has the right to cast it to Empty (type mismatch errors are not allowed, a warning signal can be emitted, but the network must be able to run indefinitely long without stopping no matter what ("it's a brain, and a brain should not segfault or throw exception")). And when there is a need to take a linear combination, it is always OK to interpret Empty as Zero. So an input node is responsible for performing a linear combination one way or another regardless of what kind of objects it got.

This is obviously too flexible for taking nice derivatives or for GPU execution. We had some ideas of inter-rewrite (reshape) between V-values and sparse one-dimensional vectors and sparse two-dimensional matrices as necessary, but V-values are more structured than this "anything goes, just make it a subclass" way.

So we might have to say that gradient-based methods and GPU-capable runs would only happen for certain types of networks or subnetworks, and that the completely general runs must stick to derivative-free optimization methods and to CPU not-too-optimized execution for the time being.

This is not set in stone - the introduction of Class of legal streamable objects does not preclude us from imposing further discipline, if we feel like it.
